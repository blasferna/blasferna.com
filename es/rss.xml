<?xml version='1.0' encoding='UTF-8'?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" version="2.0">
  <channel>
    <title>Blas Fern치ndez</title>
    <link>http://blasferna.com/es</link>
    <description>Ingeniero de Software Paraguayo 游왫릖, trabajando con Python, Java, PostgreSQL, MySQL, Oracle, Django, React, JavaScript, FastAPI y m치s.</description>
    <docs>http://www.rssboard.org/rss-specification</docs>
    <generator>python-feedgen</generator>
    <language>es</language>
    <lastBuildDate>Thu, 13 Jul 2023 12:30:15 +0000</lastBuildDate>
    <item>
      <title>Realiza c치lculos simples en tus formularios de Django utilizando django-calculation</title>
      <link>/http://blasferna.com/es/articles/realiza-calculos-simples-en-tus-formularios-django</link>
      <description>Esta aplicaci칩n proporciona un widget de Django que obtiene su valor de una expresi칩n definida en la instancia del widget.</description>
      <content:encoded>&lt;p&gt;Realiza c치lculos simples en tus formularios de Django utilizando django-calculation.&lt;/p&gt;
&lt;h2&gt;쮺칩mo funciona?&lt;/h2&gt;
&lt;p&gt;La aplicaci칩n ofrece una serie de widgets que te permiten especificar expresiones matem치ticas y/o llamadas a funciones de JavaScript.&lt;/p&gt;
&lt;p&gt;Un ejemplo b치sico ser칤a realizar una multiplicaci칩n para calcular el precio total de un registro de ventas.&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;amount = forms.DecimalField( 
    widget=calculation.FormulaInput('quantity*price')  
) 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;En tiempo de ejecuci칩n, la expresi칩n &lt;code&gt;quantity*price&lt;/code&gt; se reemplaza por los valores correspondientes a los campos del mismo nombre presentes en el formulario.&lt;/p&gt;
&lt;p&gt;Actualmente admite expresiones de tipo f칩rmula, as칤 como operaciones de suma, c치lculos de promedio, b칰squeda del valor m칤nimo, valor m치ximo y conteo de registros.&lt;/p&gt;
&lt;h2&gt;Motivaci칩n&lt;/h2&gt;
&lt;p&gt;Para ser honesto, soy demasiado perezoso para escribir c칩digo de JavaScript en plantillas que tienen formularios que requieren alg칰n tipo de c치lculo matem치tico. En un proyecto mediano o grande, la necesidad puede ser de varias cientos o miles de l칤neas de c칩digo.&lt;/p&gt;
&lt;p&gt;Como no tengo la necesidad de implementar bibliotecas frontend avanzadas, como React, Vue u otras disponibles, ya que el enfoque MTV de Django se adapta bastante bien a los proyectos en los que participo. Buscando una forma de evitar escribir c칩digo de JavaScript para esas situaciones, decid칤 probar algo similar a lo que Salesforce ofrece con FormulaField, pero en este caso algo mucho m치s pr치ctico centrado en lo que necesitaba.&lt;/p&gt;
&lt;p&gt;Durante varios a침os he sido usuario de Oracle Forms 6i, que ten칤a algo muy pr치ctico: indicar que el contenido de un cuadro de texto se generara a partir de la ejecuci칩n de una f칩rmula y algo muy interesante suced칤a cuando se hac칤a referencia a otro cuadro de texto del mismo tipo, la ejecuci칩n respetaba la dependencia del contenido de la f칩rmula, es decir, se ejecutaba en cascada.&lt;/p&gt;
&lt;p&gt;Con todo eso en mente, comenc칠 el desarrollo.&lt;/p&gt;
&lt;h2&gt;Proceso de desarrollo&lt;/h2&gt;
&lt;p&gt;La idea es bastante simple, en teor칤a, ejecutar las expresiones indicadas en la definici칩n del campo de texto en un formulario de Django, respetando las referencias que puedan tener en otras expresiones del mismo contexto y activarlas cuando se modifiquen los campos de origen.&lt;/p&gt;
&lt;h2&gt;Flujo funcional&lt;/h2&gt;
&lt;p&gt;Despu칠s de pensar en el flujo durante varios d칤as, llegu칠 a la conclusi칩n de que podr칤a funcionar de la siguiente manera.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Encontrar campos formulados:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Lo primero ser칤a identificar los campos que contienen f칩rmulas, decid칤 realizar la b칰squeda seg칰n el atributo &lt;code&gt;data-calculation&lt;/code&gt;.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Encontrar dependencias:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Luego, encontrar todos los campos referenciados en las f칩rmulas, para ello tuve que recorrer todos los campos formulados y analizar cada una de las f칩rmulas.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Determinar el orden de ejecuci칩n:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Para determinar el orden de ejecuci칩n tuve que usar un algoritmo que consiste en asignar un peso a cada campo formulado basado en el n칰mero de veces que se hizo referencia a 칠l, cuanto m치s veces se haga referencia, mayor ser치 su peso y, por lo tanto, su ejecuci칩n se considerar치 despu칠s de los campos m치s livianos.&lt;/p&gt;
&lt;p&gt;C칩digo utilizado para calcular el peso de los campos&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-javascript"&gt;function calculateWeight(obj, weight = 0) {
    weight++;
    for (let index = 0; index &amp;lt; obj.dependencies.length; index++) {
        let o = obj.dependencies[index];
        weight = calculateWeight(o, weight);
    }
    return weight;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;C칩digo para ordenar la ejecuci칩n&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-javascript"&gt;function sortExecution() {
    for (let index = 0; index &amp;lt; calculatedFields.length; index++) {
        let obj = calculatedFields[index];
        obj.weight = calculateWeight(obj);
    }
    calculatedFields.sort(function (a, b) {
        return a.weight - b.weight;
    });
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;Encontrar campos de origen:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Luego, tuve que encontrar aquellos campos que ejecutar치n los c치lculos, es decir, los campos de origen, aquellos que, cuando se modifican, ejecutar치n los c치lculos en los lugares donde se han referenciado.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Agregar eventos:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Teniendo los campos de origen, todo lo que queda es agregar el evento que desencadenar칤a las ejecuciones, decid칤 usar el evento &lt;code&gt;blur&lt;/code&gt; porque se activa despu칠s de perder el enfoque.&lt;/p&gt;
&lt;h2&gt;Instalaci칩n&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;pip install django-calculation 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Agrega &lt;code&gt;calculation&lt;/code&gt; en INSTALLED_APPS&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;INSTALLED_APPS = [
    ...
    'calculation',
]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Uso&lt;/h2&gt;
&lt;p&gt;Importa &lt;code&gt;calculation&lt;/code&gt; y completa la definici칩n.&lt;/p&gt;
&lt;h3&gt;Ejemplo&lt;/h3&gt;
&lt;p&gt;Usando el widget &lt;code&gt;FormulaInput&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-python"&gt;from django import forms

import calculation


class TestForm(forms.Form):
    quantity = forms.DecimalField()
    price = forms.DecimalField()
    amount = forms.DecimalField(
        widget=calculation.FormulaInput('quantity*price') # &amp;lt;- usando una sola expresi칩n matem치tica
    )
    apply_taxes = forms.BooleanField(initial=True)
    tax = forms.DecimalField(
        # usando expresiones matem치ticas y funciones de JavaScript.
        widget=calculation.FormulaInput('apply_taxes ? parseFloat(amount/11).toFixed(2) : 0.0') 
    )
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;django-calculation&lt;/code&gt; funciona con archivos est치ticos y, por lo tanto, es necesario incluir los medios del formulario en el archivo de la plantilla.&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-django"&gt;&amp;lt;form method=&amp;quot;post&amp;quot;&amp;gt;
    {% csrf_token %}
    {{ form }}
    &amp;lt;input type=&amp;quot;submit&amp;quot; value=&amp;quot;Submit&amp;quot;&amp;gt;
&amp;lt;/form&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;En acci칩n:&lt;/p&gt;
&lt;p&gt;&lt;img alt="calculation" src="https://user-images.githubusercontent.com/8385910/142947517-49a5d6a0-6a6c-41d6-8f14-a140ad44fa1e.gif" /&gt;&lt;/p&gt;
&lt;h2&gt;C칩digo abierto&lt;/h2&gt;
&lt;p&gt;Lo estuve usando durante varias semanas ajustando algunos detalles y despu칠s de un tiempo decid칤 lanzar el proyecto con la esperanza de que sea 칰til para otras personas, ya que para m칤 es muy pr치ctico.&lt;/p&gt;
&lt;p&gt;Para eso tuve que aplicar algunas mejoras, como incluirlo en el administrador de paquetes Python &lt;code&gt;PyPI&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Repercusi칩n&lt;/h3&gt;
&lt;p&gt;No pas칩 mucho tiempo despu칠s del primer lanzamiento que recib칤 algunos correos electr칩nicos de usuarios que preguntaban sobre algunos detalles de la biblioteca, eso fue emocionante.&lt;/p&gt;
&lt;h3&gt;Contribuir&lt;/h3&gt;
&lt;p&gt;Si tienes alguna idea sobre c칩mo mejorar la biblioteca o encontraste alg칰n error, no dudes en abrir un issue en &lt;a href="https://github.com/blasferna/django-calculation/issues"&gt;https://github.com/blasferna/django-calculation/issues&lt;/a&gt;. &lt;/p&gt;</content:encoded>
      <guid isPermaLink="false">/http://blasferna.com/es/articles/realiza-calculos-simples-en-tus-formularios-django</guid>
      <category>django</category>
      <pubDate>Mon, 11 Apr 2022 00:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Mi primer posteo</title>
      <link>/http://blasferna.com/es/articles/mi-primer-posteo</link>
      <description>춰Bienvenidos a mi blog! Este es mi primer art칤culo y estoy emocionado de compartir mis pensamientos y experiencias con ustedes.</description>
      <content:encoded>&lt;p&gt;춰Bienvenidos a mi blog! Este es mi primer art칤culo y estoy emocionado de compartir mis pensamientos y experiencias con ustedes.&lt;/p&gt;
&lt;h2&gt;Por qu칠 empec칠 a bloguear&lt;/h2&gt;
&lt;p&gt;Creo que compartir mis ideas y experiencias puede ayudar a otros a aprender y crecer tambi칠n.&lt;/p&gt;
&lt;h2&gt;Qu칠 esperar&lt;/h2&gt;
&lt;p&gt;En este blog, planeo cubrir varios temas, como tecnolog칤a, desarrollo personal, viajes y m치s.&lt;/p&gt;</content:encoded>
      <guid isPermaLink="false">/http://blasferna.com/es/articles/mi-primer-posteo</guid>
      <pubDate>Sun, 10 Apr 2022 00:00:00 +0000</pubDate>
    </item>
  </channel>
</rss>
